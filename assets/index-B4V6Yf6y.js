(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function o(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=o(r);fetch(r.href,s)}})();const a={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"c75b8d39-0943-44f9-8048-9518c734b34b","Content-Type":"application/json"}},m=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),ee=()=>fetch(`${a.baseUrl}/users/me`,{headers:a.headers}).then(m),J=()=>fetch(`${a.baseUrl}/cards`,{headers:a.headers}).then(m),te=({name:e,about:t})=>fetch(`${a.baseUrl}/users/me`,{method:"PATCH",headers:a.headers,body:JSON.stringify({name:e,about:t})}).then(m),oe=e=>fetch(`${a.baseUrl}/users/me/avatar`,{method:"PATCH",headers:a.headers,body:JSON.stringify({avatar:e})}).then(m),re=({name:e,link:t})=>fetch(`${a.baseUrl}/cards`,{method:"POST",headers:a.headers,body:JSON.stringify({name:e,link:t})}).then(m),ne=e=>fetch(`${a.baseUrl}/cards/${e}`,{method:"DELETE",headers:a.headers}).then(m),se=(e,t)=>fetch(`${a.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:a.headers}).then(o=>m(o)),ce=e=>{e.classList.toggle("card__like-button_is-active")},ie=e=>{e.remove()},le=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),R=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:n},r)=>{const s=le(),i=s.querySelector(".card__like-button"),u=s.querySelector(".card__control-button_type_delete"),_=s.querySelector(".card__image"),p=s.querySelector(".card__like-count");return _.src=e.link,_.alt=e.name,s.querySelector(".card__title").textContent=e.name,p&&(p.textContent=e.likes?e.likes.length:"0"),e.likes&&r&&e.likes.some(l=>l._id===r)&&i.classList.add("card__like-button_is-active"),e.owner&&r&&e.owner._id!==r?u.remove():n&&u.addEventListener("click",()=>n(e._id,s)),o&&i.addEventListener("click",()=>o(e._id,i)),t&&_.addEventListener("click",()=>t({name:e.name,link:e.link})),s},V=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");d(t)}},f=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",V)},d=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",V)},ae=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{d(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&d(e)})},A=(e,t,o,n)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)},ue=(e,t,o)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""},pe=(e,t,o)=>{if(t.validity.patternMismatch){const n=t.dataset.errorMessage;A(e,t,n,o)}else if(t.validity.valid)ue(e,t,o);else{const n=t.validationMessage;A(e,t,n,o)}},de=e=>e.some(t=>!t.validity.valid),me=(e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)},_e=(e,t)=>{e.disabled=!1,e.classList.remove(t.inactiveButtonClass)},O=(e,t,o)=>{de(e)?me(t,o):_e(t,o)},fe=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);O(o,n,t),o.forEach(r=>{r.addEventListener("input",()=>{pe(e,r,t),O(o,n,t)})})},he=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{o.addEventListener("submit",n=>{n.preventDefault()}),fe(o,e)})},ye={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};he(ye);const z=document.querySelector(".places__list"),P=document.querySelector(".popup_type_edit"),v=P.querySelector(".popup__form"),K=v.querySelector(".popup__input_type_name"),G=v.querySelector(".popup__input_type_description"),g=v.querySelector(".popup__button"),I=document.querySelector(".popup_type_new-card"),h=I.querySelector(".popup__form"),ve=h.querySelector(".popup__input_type_card-name"),Se=h.querySelector(".popup__input_type_url"),q=h.querySelector(".popup__button"),w=document.querySelector(".popup_type_image"),W=w.querySelector(".popup__image"),Ce=w.querySelector(".popup__caption"),Le=document.querySelector(".profile__edit-button"),be=document.querySelector(".profile__add-button"),U=document.querySelector(".profile__title"),M=document.querySelector(".profile__description"),F=document.querySelector(".profile__image"),N=document.querySelector(".popup_type_edit-avatar"),S=N.querySelector(".popup__form"),ge=S.querySelector(".popup__input"),k=S.querySelector(".popup__button"),$=document.querySelector(".popup_type_remove-card"),Q=$.querySelector(".popup__form"),E=Q.querySelector(".popup__button"),y=document.querySelector(".popup_type_info"),qe=y.querySelector(".popup__title"),ke=y.querySelector(".popup__text"),j=y.querySelector(".popup__list"),H=y.querySelector(".popup__info"),Ee=document.querySelector(".header__logo");let x=null,B=null,T=null;const C=(e,t,o)=>{e.textContent=o,e.disabled=!0},L=(e,t)=>{e.textContent=t,e.disabled=!1},X=({name:e,link:t})=>{W.src=t,W.alt=e,Ce.textContent=e,f(w)},xe=e=>{e.preventDefault();const t=g.textContent;C(g,t,"Сохранение..."),te({name:K.value,about:G.value}).then(o=>{U.textContent=o.name,M.textContent=o.about,d(P)}).catch(o=>{console.log(o)}).finally(()=>{L(g,t)})},Be=e=>{e.preventDefault();const t=k.textContent;C(k,t,"Сохранение..."),oe(ge.value).then(o=>{F.style.backgroundImage=`url(${o.avatar})`,d(N)}).catch(o=>{console.log(o)}).finally(()=>{L(k,t)})},Te=e=>{e.preventDefault();const t=q.textContent;C(q,t,"Создание..."),re({name:ve.value,link:Se.value}).then(o=>{z.prepend(R(o,{onPreviewPicture:X,onLikeIcon:Y,onDeleteCard:Z},x)),d(I)}).catch(o=>{console.log(o)}).finally(()=>{L(q,t)})};v.addEventListener("submit",xe);h.addEventListener("submit",Te);S.addEventListener("submit",Be);Le.addEventListener("click",()=>{K.value=U.textContent,G.value=M.textContent,f(P)});F.addEventListener("click",()=>{S.reset(),f(N)});be.addEventListener("click",()=>{h.reset(),f(I)});const Pe=document.querySelectorAll(".popup");Pe.forEach(e=>{ae(e)});const Y=(e,t)=>{const o=t.classList.contains("card__like-button_is-active");se(e,o).then(n=>{const r=t.parentElement.querySelector(".card__like-count");r&&(r.textContent=n.likes.length),ce(t)}).catch(n=>{console.log(n)})},Z=(e,t)=>{B=e,T=t,f($)},Ie=e=>{e.preventDefault();const t=E.textContent;C(E,t,"Удаление..."),ne(B).then(()=>{ie(T),d($),B=null,T=null}).catch(o=>{console.log(o)}).finally(()=>{L(E,t)})};Q.addEventListener("submit",Ie);const we=()=>J().then(e=>{const t=[];let o=0;const n={},r={};e.forEach(c=>{o+=c.likes.length,c.likes.forEach(l=>{let D=!1;for(let b=0;b<t.length;b++)if(t[b]===l._id){D=!0;break}D||t.push(l._id),r[l._id]=l.name,n[l._id]?n[l._id]+=1:n[l._id]=1})});let s=0,i=null;Object.keys(n).forEach(c=>{const l=n[c];l>s&&(s=l,i=c)});let u="Неизвестный";i&&r[i]&&(u=r[i]);const _=[],p=[];for(let c=0;c<e.length;c++)p.push(e[c]);p.sort((c,l)=>l.likes.length-c.likes.length);for(let c=0;c<3&&c<p.length;c++)_.push(p[c].name);return{totalUsers:t.length,totalLikes:o,maxLikesPerUser:s,championName:u,popularCards:_}}),Ue=()=>{qe.textContent="Статистика карточек",H.innerHTML="",j.innerHTML="",ke.textContent="Популярные карточки:",f(y),we().then(e=>{const t=document.getElementById("popup-info-definition-template"),o=document.getElementById("popup-info-user-preview-template");[{term:"Всего пользователей",description:e.totalUsers},{term:"Всего лайков",description:e.totalLikes},{term:"Максимально лайков от одного",description:e.maxLikesPerUser},{term:"Чемпион лайков",description:e.championName}].forEach(r=>{const s=t.content.cloneNode(!0),i=s.querySelector(".popup__info-term"),u=s.querySelector(".popup__info-description");i.textContent=r.term,u.textContent=r.description,H.appendChild(s)}),e.popularCards.forEach(r=>{const s=o.content.cloneNode(!0),i=s.querySelector(".popup__list-item");i.textContent=r,j.appendChild(s)})}).catch(e=>{console.log(e)})};Ee.addEventListener("click",Ue);Promise.all([J(),ee()]).then(([e,t])=>{F.style.backgroundImage=`url(${t.avatar})`,U.textContent=t.name,M.textContent=t.about,x=t._id,e.forEach(o=>{z.append(R(o,{onPreviewPicture:X,onLikeIcon:Y,onDeleteCard:Z},x))})}).catch(e=>{console.log(e)});
