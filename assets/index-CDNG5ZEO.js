(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function o(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=o(r);fetch(r.href,s)}})();const l={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"c75b8d39-0943-44f9-8048-9518c734b34b","Content-Type":"application/json"}},m=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),te=()=>fetch(`${l.baseUrl}/users/me`,{headers:l.headers}).then(m),z=()=>fetch(`${l.baseUrl}/cards`,{headers:l.headers}).then(m),oe=({name:e,about:t})=>fetch(`${l.baseUrl}/users/me`,{method:"PATCH",headers:l.headers,body:JSON.stringify({name:e,about:t})}).then(m),re=e=>fetch(`${l.baseUrl}/users/me/avatar`,{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:e})}).then(m),ne=({name:e,link:t})=>fetch(`${l.baseUrl}/cards`,{method:"POST",headers:l.headers,body:JSON.stringify({name:e,link:t})}).then(m),se=e=>fetch(`${l.baseUrl}/cards/${e}`,{method:"DELETE",headers:l.headers}).then(m),ce=(e,t)=>fetch(`${l.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:l.headers}).then(o=>m(o)),ie=e=>{e.classList.toggle("card__like-button_is-active")},le=e=>{e.remove()},ae=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),R=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:n},r)=>{const s=ae(),c=s.querySelector(".card__like-button"),u=s.querySelector(".card__control-button_type_delete"),d=s.querySelector(".card__image"),f=s.querySelector(".card__like-count");return d.src=e.link,d.alt=e.name,s.querySelector(".card__title").textContent=e.name,f&&(f.textContent=e.likes?e.likes.length:"0"),e.likes&&r&&e.likes.some(i=>i._id===r)&&c.classList.add("card__like-button_is-active"),e.owner&&r&&e.owner._id!==r?u.remove():n&&u.addEventListener("click",()=>n(e._id,s)),o&&c.addEventListener("click",()=>o(e._id,c)),t&&d.addEventListener("click",()=>t({name:e.name,link:e.link})),s},V=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");p(t)}},_=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",V)},p=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",V)},ue=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{p(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&p(e)})},A=(e,t,o,n)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)},de=(e,t,o)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""},pe=(e,t,o)=>{if(t.validity.patternMismatch){const n=t.dataset.errorMessage;A(e,t,n,o)}else if(t.validity.valid)de(e,t,o);else{const n=t.validationMessage;A(e,t,n,o)}},me=e=>e.some(t=>!t.validity.valid),_e=(e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)},fe=(e,t)=>{e.disabled=!1,e.classList.remove(t.inactiveButtonClass)},O=(e,t,o)=>{me(e)?_e(t,o):fe(t,o)},he=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);O(o,n,t),o.forEach(r=>{r.addEventListener("input",()=>{pe(e,r,t),O(o,n,t)})})},ye=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{o.addEventListener("submit",n=>{n.preventDefault()}),he(o,e)})},ve={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};ye(ve);const K=document.querySelector(".places__list"),I=document.querySelector(".popup_type_edit"),S=I.querySelector(".popup__form"),G=S.querySelector(".popup__input_type_name"),Q=S.querySelector(".popup__input_type_description"),g=S.querySelector(".popup__button"),T=document.querySelector(".popup_type_new-card"),y=T.querySelector(".popup__form"),Se=y.querySelector(".popup__input_type_card-name"),Ce=y.querySelector(".popup__input_type_url"),q=y.querySelector(".popup__button"),P=document.querySelector(".popup_type_image"),W=P.querySelector(".popup__image"),Le=P.querySelector(".popup__caption"),be=document.querySelector(".profile__edit-button"),ge=document.querySelector(".profile__add-button"),w=document.querySelector(".profile__title"),U=document.querySelector(".profile__description"),M=document.querySelector(".profile__image"),F=document.querySelector(".popup_type_edit-avatar"),C=F.querySelector(".popup__form"),qe=C.querySelector(".popup__input"),k=C.querySelector(".popup__button"),$=document.querySelector(".popup_type_remove-card"),X=$.querySelector(".popup__form"),j=X.querySelector(".popup__button"),v=document.querySelector(".popup_type_info"),ke=v.querySelector(".popup__title"),Ee=v.querySelector(".popup__text"),H=v.querySelector(".popup__list"),J=v.querySelector(".popup__info"),xe=document.querySelector(".header__logo");let E=null,x=null,B=null;const L=(e,t,o)=>{e.textContent=o,e.disabled=!0},D=(e,t)=>{e.textContent=t,e.disabled=!1},Y=({name:e,link:t})=>{W.src=t,W.alt=e,Le.textContent=e,_(P)},Be=e=>{e.preventDefault();const t=g.textContent;L(g,t,"Сохранение..."),oe({name:G.value,about:Q.value}).then(o=>{w.textContent=o.name,U.textContent=o.about,p(I)}).catch(o=>{console.log(o)}).finally(()=>{D(g,t)})},Ie=e=>{e.preventDefault();const t=k.textContent;L(k,t,"Сохранение..."),re(qe.value).then(o=>{M.style.backgroundImage=`url(${o.avatar})`,p(F)}).catch(o=>{console.log(o)}).finally(()=>{D(k,t)})},Te=e=>{e.preventDefault();const t=q.textContent;L(q,t,"Создание..."),ne({name:Se.value,link:Ce.value}).then(o=>{K.prepend(R(o,{onPreviewPicture:Y,onLikeIcon:Z,onDeleteCard:ee},E)),p(T)}).catch(o=>{console.log(o)}).finally(()=>{D(q,t)})};S.addEventListener("submit",Be);y.addEventListener("submit",Te);C.addEventListener("submit",Ie);be.addEventListener("click",()=>{G.value=w.textContent,Q.value=U.textContent,_(I)});M.addEventListener("click",()=>{C.reset(),_(F)});ge.addEventListener("click",()=>{y.reset(),_(T)});const Pe=document.querySelectorAll(".popup");Pe.forEach(e=>{ue(e)});const Z=(e,t)=>{const o=t.classList.contains("card__like-button_is-active");ce(e,o).then(n=>{const r=t.parentElement.querySelector(".card__like-count");r&&(r.textContent=n.likes.length),ie(t)}).catch(n=>{console.log(n)})},ee=(e,t)=>{x=e,B=t,_($)},we=e=>{e.preventDefault();const t=j.textContent;L(j,t,"Удаление..."),se(x).then(()=>{le(B),p($),x=null,B=null}).catch(o=>{console.log(o)})};X.addEventListener("submit",we);const Ue=()=>z().then(e=>{const t=new Set,o={},n={};let r=0;e.forEach(a=>{r+=a.likes.length,a.likes.forEach(i=>{t.add(i._id),o[i._id]?o[i._id]+=1:o[i._id]=1,n[i._id]||(n[i._id]=[]),n[i._id].push(a.name)})});let s=null,c=0;const u=Object.keys(o);for(let a=0;a<u.length;a++){const i=u[a],h=o[i];h>c&&(c=h,s=i)}let d="Неизвестный",f=[];if(s){let a=null;for(let i=0;i<e.length;i++){const h=e[i];for(let b=0;b<h.likes.length;b++){const N=h.likes[b];if(N._id===s){a=N;break}}if(a)break}a&&(d=a.name,f=n[s]||[])}return{totalUsers:t.size,totalLikes:r,maxLikesPerUser:c,championName:d,championCards:f}}),Me=()=>{ke.textContent="Статистика карточек",J.innerHTML="",H.innerHTML="",Ee.textContent="Популярные карточки:",_(v),Ue().then(e=>{const t=document.getElementById("popup-info-definition-template"),o=document.getElementById("popup-info-user-preview-template");[{term:"Всего пользователей",description:e.totalUsers},{term:"Всего лайков",description:e.totalLikes},{term:"Максимально лайков от одного",description:e.maxLikesPerUser},{term:"Чемпион лайков",description:e.championName}].forEach(s=>{const c=t.content.cloneNode(!0),u=c.querySelector(".popup__info-term"),d=c.querySelector(".popup__info-description");u.textContent=s.term,d.textContent=s.description,J.appendChild(c)}),e.championCards.slice(0,3).forEach(s=>{const c=o.content.cloneNode(!0),u=c.querySelector(".popup__list-item");u.textContent=s,H.appendChild(c)})}).catch(e=>{console.log(e)})};xe.addEventListener("click",Me);Promise.all([z(),te()]).then(([e,t])=>{M.style.backgroundImage=`url(${t.avatar})`,w.textContent=t.name,U.textContent=t.about,E=t._id,e.forEach(o=>{K.append(R(o,{onPreviewPicture:Y,onLikeIcon:Z,onDeleteCard:ee},E))})}).catch(e=>{console.log(e)});
